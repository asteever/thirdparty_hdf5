cmake_minimum_required (VERSION 3.1.0)
PROJECT (HDF5_FORTRAN_TESTPAR C CXX Fortran)

#-----------------------------------------------------------------------------
# Setup include Directories
#-----------------------------------------------------------------------------
INCLUDE_DIRECTORIES (${HDF5_F90_BINARY_DIR} ${HDF5_F90_SRC_DIR}/src)

#-----------------------------------------------------------------------------
# Add Tests
#-----------------------------------------------------------------------------

#-- Adding test for parallel_test
add_executable (parallel_test
    ptest.f90
    hyper.f90
    mdset.f90
)
TARGET_NAMING (parallel_test ${LIB_TYPE})
TARGET_FORTRAN_PROPERTIES (parallel_test ${LIB_TYPE} " " " ")
target_link_libraries (parallel_test 
    ${HDF5_F90_TEST_LIB_TARGET}
    ${HDF5_F90_LIB_TARGET}
    ${HDF5_LIB_TARGET}
    ${MPI_Fortran_LIBRARIES}
)
if (WIN32 AND MSVC)
  target_link_libraries (parallel_test "ws2_32.lib")
endif (WIN32 AND MSVC)
target_include_directories (parallel_test PRIVATE ${CMAKE_Fortran_MODULE_DIRECTORY})
set_target_properties (parallel_test PROPERTIES LINKER_LANGUAGE Fortran)
set_target_properties (parallel_test PROPERTIES FOLDER test/fortran)

#-- Adding test for parallel_test_F03
if (HDF5_ENABLE_F2003)
  add_executable (parallel_test_F03
      ptest_F03.f90
      multidsetrw_F03.f90
  )
  TARGET_NAMING (parallel_test_F03 ${LIB_TYPE})
  TARGET_FORTRAN_PROPERTIES (parallel_test_F03 " " " ")
  target_link_libraries (parallel_test_F03
      ${HDF5_F90_TEST_LIB_TARGET}
      ${HDF5_F90_LIB_TARGET}
      ${HDF5_LIB_TARGET}
  )
  if (WIN32 AND MSVC)
    target_link_libraries (parallel_test_F03 "ws2_32.lib")
  endif (WIN32 AND MSVC)
  set_target_properties (parallel_test_F03 PROPERTIES LINKER_LANGUAGE Fortran)
  set_target_properties (parallel_test_F03 PROPERTIES FOLDER test/fortran)
endif (HDF5_ENABLE_F2003)

include (CMakeTests.cmake)
