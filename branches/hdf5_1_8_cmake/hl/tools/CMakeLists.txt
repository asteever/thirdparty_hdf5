cmake_minimum_required (VERSION 2.8)
PROJECT (HDF5_HL_TOOLS)

#-----------------------------------------------------------------------------
# Define Sources
#-----------------------------------------------------------------------------
SET (GIF2H5_SRCS
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/gif.h
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/decompress.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/gif2hdf.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/gif2mem.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/gifread.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/writehdf.c
    ${HDF5_TOOLS_SOURCE_DIR}/lib/h5tools_utils.c
)

#-- Add gif2hdf5 program
INCLUDE_DIRECTORIES (${HDF5_TOOLS_SOURCE_DIR}/lib)
INCLUDE_DIRECTORIES (${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5)

ADD_EXECUTABLE (gif2h5 ${GIF2H5_SRCS})
IF (BUILD_SHARED_LIBS)
  IF (WIN32)
    SET_PROPERTY (TARGET gif2h5 
        APPEND PROPERTY COMPILE_DEFINITIONS 
            _HDF5USEDLL_
    )
    SET_TARGET_PROPERTIES (gif2h5 PROPERTIES OUTPUT_NAME "gif2h5")
    SET_TARGET_PROPERTIES (gif2h5 PROPERTIES PREFIX "dll")
  ENDIF (WIN32)
ENDIF (BUILD_SHARED_LIBS)
TARGET_LINK_LIBRARIES (gif2h5 ${HDF5_HL_LIB_TARGET} ${HDF5_LIB_TARGET} ${HDF5_TOOLS_LIB_TARGET})

#-- Add h52gif program
SET (hdf2gif_SRCS
    ${HDF5_TOOLS_SOURCE_DIR}/lib/h5tools_utils.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/hdf2gif.c
    ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/hdfgifwr.c
)
ADD_EXECUTABLE (hdf2gif ${hdf2gif_SRCS})
IF (BUILD_SHARED_LIBS)
  IF (WIN32)
    SET_PROPERTY (TARGET hdf2gif 
        APPEND PROPERTY COMPILE_DEFINITIONS 
            _HDF5USEDLL_
    )
    SET_TARGET_PROPERTIES (hdf2gif PROPERTIES OUTPUT_NAME "hdf2gif")
    SET_TARGET_PROPERTIES (hdf2gif PROPERTIES PREFIX "dll")
  ENDIF (WIN32)
ENDIF (BUILD_SHARED_LIBS)
TARGET_LINK_LIBRARIES (hdf2gif ${HDF5_HL_LIB_TARGET} ${HDF5_LIB_TARGET} ${HDF5_TOOLS_LIB_TARGET})

# --------------------------------------------------------------------
# This executable can generate the actual test files - Currently not
#  used in the CMake Build system as we rely on the test files that are
#  shipped with HDF5 source archives
# --------------------------------------------------------------------
IF (NOT BUILD_SHARED_LIBS)
    ADD_EXECUTABLE (hl_h52gifgentest ${HDF5_HL_TOOLS_SOURCE_DIR}/gif2h5/h52gifgentst.c)
    TARGET_LINK_LIBRARIES (hl_h52gifgentest ${HDF5_HL_LIB_TARGET} ${HDF5_LIB_TARGET})
    GET_TARGET_PROPERTY (hl_h52gifgentestpath hl_h52gifgentest LOCATION)
    GET_FILENAME_COMPONENT (hl_h52gifgentestexe ${hl_h52gifgentestpath} NAME)
#    ADD_TEST (hl_h52gifgentest ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${hl_h52gifgentestexe})
ENDIF (NOT BUILD_SHARED_LIBS)

#-----------------------------------------------------------------------------
# Add file(s) to CMake Install 
#-----------------------------------------------------------------------------
INSTALL (
    TARGETS
        gif2h5 
        hdf2gif
    RUNTIME DESTINATION
        bin/tools
)
